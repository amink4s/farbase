# PR: UI & points/profile features — Nov 04, 2025

## Title
feat(ui): header navigation, /me profile with points & contributions, responsive Explore, contribution links, and server cache for user API

## Summary
This change improves navigation and UX, surfaces contribution points to users, and reduces Supabase load for profile pages by introducing a short-lived server-side cache. It also cleans up the Create CTA and improves the Explore landing and list pages for better mobile responsiveness.

Key outcomes:
- The `farpedia` site title in the header is now a permanent link to `/`.
- The avatar/username in the top-right is clickable and opens the user's profile at `/me`.
- A new `/me` profile page displays the user's total points and recent contributions (with links when available).
- Contributions include best-effort resolved `source_url` values linking to the relevant article or edit page.
- The Explore page now shows prominent, spaced cards for "Projects" and "Tokens"; project/token lists are rendered as responsive card grids for mobile.
- The Create button on the main page shows only `+` (improved compact CTA) and keeps an aria-label for accessibility.
- Added `src/pages/api/users/[fid]/index.ts` which returns `total_points` and recent `contributions` for the requested FID. The endpoint uses an in-memory cache (TTL default 60s) controlled by `USER_CACHE_TTL_SECONDS` to reduce Supabase REST calls.

## Files changed / added
- Edited: `components/Header.tsx` — header links and profile link
- Edited: `app/page.tsx` — create button text and aria-label
- Edited: `app/explore/page.tsx` — improved Explore landing
- Edited: `app/explore/projects/page.tsx` — responsive project cards
- Edited: `app/explore/tokens/page.tsx` — responsive token cards
- Added: `app/me/page.tsx` — client profile page showing points & contributions
- Added: `src/pages/api/users/[fid]/index.ts` — server API for user points & contributions (with caching & source resolution)
- Added: `ENV_VARS.md` — environment variables checklist (committed earlier)

Commit: 78ea65b (pushed to `main`) — includes build validation locally (production build passed).

## Environment / Deployment notes
- Required server env vars (set in Vercel / host):
  - `SUPABASE_URL` — Supabase base URL
  - `SUPABASE_SERVICE_ROLE_KEY` — Supabase service role key (SERVER-ONLY) — used by server API endpoints
  - Optional: `USER_CACHE_TTL_SECONDS` — integer seconds to control cache TTL for `/api/users/:fid` (defaults to 60)

- Ensure `SUPABASE_SERVICE_ROLE_KEY` is configured in the Production and Preview environments on Vercel (do not expose as `NEXT_PUBLIC_`).

## Testing / How to verify locally
1. Start the app locally with a `.env.local` including `SUPABASE_URL` and `SUPABASE_SERVICE_ROLE_KEY` (see `ENV_VARS.md`).
2. Build and run the production server to mimic deployment:

```bash
npm run build
npm start
```

3. Open the app in the browser:
  - Click the `farpedia` title — it should go to `/`.
  - Sign in with the mini-app wallet (if using OnchainKit) — avatar/name should link to `/me`.
  - Visit `/me` to view total points and a list of recent contributions (links should be present when resolvable).
  - Open `/explore` and confirm the Projects/Tokens cards are prominent and tappable. On narrow screens, cards should wrap into a single-column stack.

4. API verification:
  - Call: `GET /api/users/<FID>` and confirm JSON contains `total_points` and `contributions` (each contribution may include `source_url`).
  - Observe that repeated calls within the TTL are served from in-memory cache (no visible errors). To test TTL expiry, set `USER_CACHE_TTL_SECONDS=3` and observe updated data after wait.

## Rollback & Safety
- To rollback, revert the commit (78ea65b) and redeploy. The change is additive and non-destructive — it introduces UI links and an API endpoint plus an in-memory cache. No destructive DB migrations were run in this change.

## Follow-ups / recommended next work
1. Replace the per-instance in-memory cache with a shared cache (Redis) for serverless/scale-to-zero production environments.
2. Add pagination and richer contribution items (show article titles inline, link directly to article/edit pages with human-friendly text).
3. Create a Supabase RPC that can resolve contribution source metadata in a single DB-side call to avoid multiple REST lookups.
4. Add unit/integration tests for the `/api/users/:fid` endpoint and for the profile UI (happy path + missing env).
5. Add reviewer UI and more profile stats (rankings, badges, contribution breakdown by type).

If you want, I can open a PR with this changelog as the PR description and include the items above as checklist tasks in the PR body.
